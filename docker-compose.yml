# Docker Compose for motea complete deployment
# Based on the open-source project Notea, originally created by qingwei-li<cinwell.li@gmail.com>
# Modified and maintained by waycaan, 2025.
#
# ğŸš€ å¿«é€Ÿå¼€å§‹:
# 1. ä¿®æ”¹ä¸‹é¢çš„ PASSWORD ä¸ºä½ çš„å®‰å…¨å¯†ç 
# 2. ä¿®æ”¹ PRELOAD_NOTES_COUNT ä¸ºä½ æƒ³è¦çš„é¢„åŠ è½½ç¬”è®°æ•°é‡
# 3. è¿è¡Œ: docker-compose up -d
# 4. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦1-2åˆ†é’Ÿï¼‰
# 5. è®¿é—®: http://localhost:3000
#
# ğŸ“ æ•°æ®å¤‡ä»½:
# - æ•°æ®åº“æ–‡ä»¶ä½äº Docker å· postgres_data ä¸­
# - å¯ä»¥å–æ¶ˆæ³¨é‡Šç¬¬67è¡Œï¼Œå°†æ•°æ®åº“æ˜ å°„åˆ°ä¸»æœºç›®å½• ./motea_database
# - ç„¶åå¯ä»¥ç›´æ¥é€šè¿‡FTPå¤‡ä»½æ•´ä¸ª motea_database æ–‡ä»¶å¤¹
#
# âš™ï¸ é…ç½®è¯´æ˜:
# - PASSWORD: åº”ç”¨è®¿é—®å¯†ç ï¼Œé»˜è®¤ "motea"ï¼Œå¼ºçƒˆå»ºè®®ä¿®æ”¹
# - PRELOAD_NOTES_COUNT: é¢„åŠ è½½ç¬”è®°æ•°é‡ï¼Œå»ºè®®5-20ï¼Œé»˜è®¤10

version: '3.8'

services:
  # PostgreSQL æ•°æ®åº“æœåŠ¡
  postgres:
    image: postgres:15-alpine
    container_name: motea-postgres
    environment:
      POSTGRES_DB: motea 
      POSTGRES_USER: motea
      POSTGRES_PASSWORD: motea
    volumes:
      # æŒä¹…åŒ–æ•°æ®åº“æ•°æ®
      - ./postgres_data:/var/lib/postgresql/data

      # å¯é€‰ï¼šæ˜ å°„æ•°æ®åº“åˆ°ä¸»æœºç›®å½•ï¼Œä¾¿äºç›´æ¥å¤‡ä»½
      # - ./motea_database:/var/lib/postgresql/data

    restart: unless-stopped

  # motea åº”ç”¨æœåŠ¡
  motea:
    image: ghcr.io/waycaan/motea:${TAG:-latest}
    container_name: motea
    ports:
      - "3000:3000"  //è‡ªå·±å†³å®šæ˜ å°„ç«¯å£ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
    environment:
      # Basic configuration
      - NODE_ENV=production
      - PORT=3000
      - HOSTNAME=0.0.0.0
      - NEXT_TELEMETRY_DISABLED=1
      # åº”ç”¨åŸºç¡€URLï¼ˆå…³é”®é…ç½®ï¼‰
      - BASE_URL=http://localhost:3000
      - COOKIE_SECURE=false 
      # Database connection (ç¦ç”¨SSLï¼Œå› ä¸ºå†…éƒ¨ç½‘ç»œä¸éœ€è¦)
      - DATABASE_URL=postgresql://motea:motea@postgres:5432/motea?sslmode=disable //disableè¦ä¿ç•™ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯å†…å»ºçš„æ•°æ®åº“ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ä½ è‡ªå·±çš„åŠ éƒ‘è™

      # ========================================
      # ğŸ”§ ç”¨æˆ·é…ç½®åŒºåŸŸ - è¯·ä¿®æ”¹ä»¥ä¸‹ä¸¤ä¸ªå˜é‡
      # ========================================

      # åº”ç”¨è®¿é—®å¯†ç ï¼ˆå¼ºçƒˆå»ºè®®ä¿®æ”¹ï¼ï¼‰
      - PASSWORD=motea

      # é¢„åŠ è½½ç¬”è®°æ•°é‡ï¼ˆå»ºè®®5-20ï¼‰
      - PRELOAD_NOTES_COUNT=10

      # ========================================

      # å…¶ä»–é…ç½®ï¼ˆé€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼‰
      - DISABLE_PASSWORD=false

    restart: unless-stopped

    # ç­‰å¾…æ•°æ®åº“å¯åŠ¨
    depends_on:
      - postgres

    # Resource limits
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.8'
        reservations:
          memory: 256M
          cpus: '0.25'

volumes:
  postgres_data:
    driver: local
